---
phase: 02-signature-capture-and-confirmation
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Opening the signing link on a mobile phone shows Hebrew page 'חתום פה' with a touch-draw signature area"
    - "Recipient can draw a signature with a finger (touch) and with a mouse on desktop, and can clear and redraw"
    - "Tapping 'שלח' saves a non-blank PNG file to signatures/ folder on the server"
    - "The signatures/ folder is not directly browsable or downloadable via URL"
    - "After PNG is saved, confirmation SMS 'המסמך נחתם' is sent to 0526804680 and arrives on Sharon's phone"
  artifacts:
    - path: "sign.html"
      provides: "Public signing page with canvas"
    - path: "api/save-signature.php"
      provides: "PNG save and confirmation SMS endpoint"
    - path: "signatures/sig_*.png"
      provides: "At least one saved signature PNG file"
  key_links:
    - from: "dashboard.html dispatch button"
      to: "SMS with link to sign.html"
      via: "send-sms.php sends SMS containing sign.html URL"
      pattern: "sign\\.html"
    - from: "sign.html submit"
      to: "api/save-signature.php"
      via: "fetch POST with base64 PNG"
      pattern: "save-signature"
    - from: "api/save-signature.php"
      to: "Sharon's phone"
      via: "Micropay SMS with confirmation message"
      pattern: "ADMIN_PHONE"
---

<objective>
End-to-end human verification of the complete signature dispatch loop: login, dispatch SMS, open link on phone, draw and submit signature, confirm PNG saved and confirmation SMS received.

Purpose: This is the final verification that proves the full send-sign-confirm loop works on a real phone with real SMS delivery. It validates all 5 Phase 2 success criteria from the ROADMAP.

Output: Verified working system — Phase 2 and the entire project complete.
</objective>

<execution_context>
@C:/Users/Alias/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Alias/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-signature-capture-and-confirmation/02-01-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 1: Verify full signing loop end-to-end on real phone</name>
  <files>None — verification only</files>
  <action>
WHAT WAS BUILT: Complete signature capture and confirmation system:
- sign.html: Mobile-friendly Hebrew signing page with signature_pad v5.1.3 canvas, touch drawing, clear/submit buttons
- api/save-signature.php: Base64 PNG receiver with GD validation, file save to signatures/, and confirmation SMS via Micropay

The GitHub Actions FTP workflow will auto-deploy on push. Once deployed, test the full loop below.
  </action>
  <verify>
After code is pushed and deployed to ch-ah.info/FirstApp/:

1. **Signing page loads correctly (SIGN-01, SIGN-02):**
   - Open https://ch-ah.info/FirstApp/sign.html on your phone browser
   - Verify: Hebrew title "חתום פה" visible, white canvas area with border visible, "שלח" and "נקה" buttons visible
   - Verify: Page is in RTL layout (Hebrew)

2. **Drawing works on touch and desktop (SIGN-03, SIGN-04, SIGN-05):**
   - On the phone: draw a signature with your finger on the canvas
   - Verify: Smooth black strokes appear as you draw (not blurry, not offset)
   - Tap "נקה" button — canvas should clear completely
   - Draw a new signature (proving clear-and-redraw works)
   - (Optional: also test on desktop with mouse)

3. **Empty canvas rejection:**
   - Open sign.html fresh (or tap "נקה" to clear)
   - Tap "שלח" WITHOUT drawing anything
   - Verify: Error message "אנא חתום לפני השליחה" appears. No request sent to server.

4. **Successful submission (SIGN-06, STOR-01):**
   - Draw a signature on the canvas
   - Tap "שלח"
   - Verify: Button shows "שולח..." briefly, then canvas area disappears and success message "החתימה נשמרה. תודה!" appears
   - Verify: A new sig_*.png file exists in ch-ah.info/FirstApp/signatures/ (check via cPanel File Manager)

5. **Folder protection (STOR-02):**
   - Try to open https://ch-ah.info/FirstApp/signatures/ in a browser
   - Verify: Access denied (403 Forbidden), NOT a directory listing
   - Try to open https://ch-ah.info/FirstApp/signatures/sig_[filename].png directly
   - Verify: Access denied (403 Forbidden)

6. **Confirmation SMS received (NOTF-01):**
   - After the successful submission in step 4, check your phone (0526804680)
   - Verify: SMS "המסמך נחתם" received from "Chemo IT"

7. **Full loop from dispatch (end-to-end):**
   - Open https://ch-ah.info/FirstApp/ and log in as Sharonb / 1532
   - Click "שלח בקשת חתימה" to dispatch the SMS
   - Open the link from the received SMS on your phone
   - Draw and submit a signature
   - Confirm: confirmation SMS "המסמך נחתם" arrives
  </verify>
  <done>All 7 verification checks pass: signing page loads with Hebrew canvas, finger drawing works, clear-and-redraw works, empty canvas rejected, signature saves as PNG, signatures folder is protected, confirmation SMS arrives, full dispatch-sign-confirm loop works end-to-end. Type "approved" if all pass, or describe which steps failed.</done>
</task>

</tasks>

<verification>
All 5 Phase 2 ROADMAP success criteria verified by human on real device:
1. Signing link opens Hebrew page "חתום פה" with touch-draw area
2. Finger drawing and mouse drawing work, clear-and-redraw works
3. Submit saves non-blank PNG to signatures/ folder
4. signatures/ folder not browsable via URL
5. Confirmation SMS "המסמך נחתם" received on Sharon's phone
</verification>

<success_criteria>
- Sharon confirms all 7 verification checks pass on a real phone with real SMS
- At least one sig_*.png file exists in signatures/ folder on the server
- The full dispatch-sign-confirm loop proven working end-to-end
</success_criteria>

<output>
After completion, create `.planning/phases/02-signature-capture-and-confirmation/02-02-SUMMARY.md`
</output>
